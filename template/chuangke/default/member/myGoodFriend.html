<layout name="common/layout_nav" />
    <div class="page friend">
        <div class="page-hd">
            <div class="header">
                <div class="header-left">
                    <a href="javascript:history.go(-1)" class="left-arrow"></a>
                </div>
                <div class="header-title">我的好友</div>
                <div class="header-right">
                    <a href="{:U('chuangke/Member/goodFriendList')}">好友列表</a>
                </div>
            </div>
        </div>
        <div class="page-bd">
            <!-- 页面内容-->

            <div class="block">
                <img src="{$data.img}" class="code_img" alt="">
                <p class="fs26 color_8" >邀请码：<span class="code">{$data.code}</span></p>
                <div class="btncCell">
                    <button class="fs28 color_w" onclick="copyUrl2()" id="Copy" data-clipboard-action="copy" data-clipboard-target="#copyUrl" >复制邀请链接</button>
                    <!--<button class="fs28 color_w" onclick="preserveImg()">保存为图片</button>-->
                    <button class="fs28 color_w" onclick="savePicture()">保存为图片</button>
                </div>
            </div>
            <div class="tips fs26 color_8">
                1、每推荐一个用户注册可得50元保证金，可提现<br/>
                2、好友每次还款可获得5%-10%手续费提成<br/>
                3、好友每次众筹可获得3%-8%收益分成
            </div>
        </div>
    </div>
<textarea  id="biao1" style="z-index: -1;" style="display: none;">{$data.url}</textarea>
<script src="https://cdn.jsdelivr.net/clipboard.js/1.5.12/clipboard.min.js"></script>
<script src="__PUBLIC__/static/chuangke/js/lib/jquery-2.1.4.js"></script>
<script src="__PUBLIC__/static/chuangke/js/jquery-weui.min.js"></script>
<script src="__PUBLIC__/static/chuangke/js/lib/fastclick.js"></script>
<script src="__PUBLIC__/static/chuangke/js/layer/layer.js"></script>
<script>
    $(function() {
        FastClick.attach(document.body);
    });
</script>
<script>
    var code = "{$data.code}";
    // window.onload=function (){
    //     var clipboard = new Clipboard('#Copy');
    //     clipboard.on('success', function(e) {
    //         $.toptip("复制成功！", 1500, 'success');
    //         e.clearSelection();
    //     });
    // }

    function copyUrl2(obj)
    {
        var Url2=document.getElementById("biao1");
        Url2.select(); // 选择对象
        document.execCommand("Copy"); // 执行浏览器复制命令
        // alert("已复制好，可贴粘。");
        layer.msg("已复制好，可贴粘。");

    }

    function preserveImg(argument) {
        // downloadPicturetToBase64(String base64DataStr)
        downloadIamge('.code_img',code);
    }
    function downloadIamge(selector, name) {
        // 通过选择器获取img元素
        var img = document.querySelector(selector)
        // 将图片的src属性作为URL地址
        var url = img.src
        var a = document.createElement('a')
        var event = new MouseEvent('click')

        a.download = name || '下载图片名称'
        a.href = url

        a.dispatchEvent(event)
    }

    function savePicture() {

        // 创建下载任务
        // picurl="http://chuangke1.qingsongshow.cn/public/upload/head_pic/20190801/286395c7380967d492803c50eac7677f.jpg";
        picurl="https://timgsa.baidu.com/timg?image&quality=80&size=b9999_10000&sec=1564823307816&di=dc34cd7babf2808549ef8208be5fc85f&imgtype=0&src=http%3A%2F%2F03.imgmini.eastday.com%2Fmobile%2F20180107%2F20180107005236_d76c662ebbddad358fbedb159202df76_2.jpeg";
        //图片保存到手机后的路径
        picname="_downloads/erwei.png";
        var dtask = plus.downloader.createDownload(picurl, {}, function ( d, status ) {
        // 下载完成
            if ( status == 200 ) {
        //	alert( "Download success: " + d.filename );
                plus.gallery.save(picname,function() {//保存到相册方法
                    mui.toast('已保存到手机相册');
                }, function() {
                    mui.toast('保存失败，请重试！');
                });
            } else {
        //	alert( "Download failed: " + status ); 
            }
        });
        //dtask.addEventListener( "statechanged", onStateChanged, false );
        dtask.start();//开始下载
    }

</script>
