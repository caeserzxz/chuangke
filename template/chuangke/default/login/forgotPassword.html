<layout name="common/layout_nav" />
    <div class="page login forgetPwd">
        <div class="page-hd">
            <div class="header">
    <div class="header-left">
        <a href="javascript:history.go(-1)" class="left-arrow"></a>
    </div>
    <div class="header-title"></div>
    <div class="header-right">
        <a href="#"></a>
    </div>
</div>
        </div>
        <div class="page-bd">
            <div class="logoimg">
                <img src="__PUBLIC__/static/chuangke/images/logo.png" alt="" class="login_img">
            </div>
            <div class="form_box">
                <p class="tou ">忘记密码</p>
                <input type="number" class="fs28 tel" id="mobile" placeholder="请输入您的手机号">
                <div class="yanzheng">
                    <div class="left">
                        <input class="input fs28" id="verify_code" type="number" pattern="[0-9]*" placeholder="验证码">
                    </div>
                    <div class="right">
                        <span class="fs26  getCode" onclick="codeButton()">获取验证码</span>
                        <span class="fs26  time" style="display: none">60s</span>
                    </div>
                </div>
                <input type="password" class="fs28 pwd1" id="password" placeholder="新密码">
                <input type="password" class="fs28 pwd2" id="re_password" placeholder="请再次输入确认密码">
                <a href="javascript:;" class="weui-btn loading_btn chongzhi fs30">重置密码</a>
            </div>
        </div>



    </div>

    <script src="__PUBLIC__/static/chuangke/js/lib/jquery-2.1.4.js"></script>
<script src="__PUBLIC__/static/chuangke/js/jquery-weui.min.js"></script>
<script src="__PUBLIC__/static/chuangke/js/lib/fastclick.js"></script>
<script src="__PUBLIC__/static/chuangke/js/layer/layer.js"></script>
<script>
    $(function() {
        FastClick.attach(document.body);
    });
</script>
    <script>
        var check_verify_code = {$config.check_verify_code};
        function codeButton() {

            var mobile = $("#mobile").val();
            // console.log(mobile);
            //验证手机格式
            var reg = /(1[3-9]\d{9}$)/;
            if (!reg.test(mobile)) {
                $("#mobile").focus();
                layer.msg('请输入正确的手机号码', function () {
                    $("button").attr('has-click', '0');
                });
                return false;
            }


            var timeObj = $('.time')
            var getCodeObj = $('.getCode')
            getCodeObj.hide();
            timeObj.show();
            var time = 60;
            var set = setInterval(function () {
                timeObj.text("" + --time + "s");
                if (time <= 0) {
                    timeObj.hide();
                    getCodeObj.show();
                    clearInterval(set);
                }
            }, 1000);



            //发送验证码
            $.ajax({
                url: '/chuangke/login/captcha',
                type: 'POST',
                data: {
                    mobile: mobile,
                    type:'reg_user',
                },
                success: function (data1) {
                    console.log(data1);

                    if (data1.status == 200) {
                        res_data = data1.result;
                        // console.log(res_data);
                        layer.msg('发送成功');
                    }
                    else {
                        layer.msg(data1.msg);
                        $("button").attr('has-click', '0');
                        return;
                    }

                },
                error: function () {
                    getCodeObj.show();
                    timeObj.hide();
                    layer.msg('发送失败');
                    $("button").attr('has-click', '0');
                },


            });
        }

        $(".chongzhi").on("click", function () {
           var mobile = $('#mobile').val();
           var verify_code = $('#verify_code').val();
           var password  = $('#password').val();
           var re_password = $('#re_password').val();

            if(mobile==''||mobile==null){
                layer.msg('请填写手机号',{icon:5,time:2000});
                return false;
            }else if((verify_code==''||verify_code==null)&&check_verify_code==1){
                layer.msg('请填写验证码',{icon:5,time:2000});
                return false;
            }else if(password==''||password==null){
                layer.msg('请填写新密码',{icon:5,time:2000});
                return false;
            }else if(re_password==''||re_password==null){
                layer.msg('请填确认密码',{icon:5,time:2000});
                return false;
            }

            $.ajax({
                'url':"{:U('chuangke/login/forgotPassword')}",
                'type':'post',
                'data':{'mobile':mobile,'verify_code':verify_code,'password':password,'re_password':re_password},
                'dataType':'json',
                'success':function(data){
                    if(data.status==1){
                        layer.msg(data.msg,{icon:1,time:2000},function(){
                            window.location.href = "{:U('chuangke/login/index')}";
                        });
                        return false;
                    }else{
                        layer.msg(data.msg,{icon:5,time:2000});
                        return false;
                    }
                }
            });
        })
    </script>
